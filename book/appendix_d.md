<!-- DO NOT EDIT THIS FILE.

This file is periodically generated from the content in the `/src/`
directory, so all fixes need to be made in `/src/`.
-->

[TOC]

## 附錄 D：實用的開發工具

在本附錄中，我們將討論 Rust 專案提供的一些實用開發工具。我們將看看自動格式化、快速應用警告修正的方法、一個 linter，以及與 IDE 整合。

## 使用 rustfmt 自動格式化

`rustfmt` 工具會根據社群的程式碼風格來重新格式化你的程式碼。許多協作專案都使用 `rustfmt` 來避免因撰寫 Rust 時該用哪種風格而產生爭論：每個人都用這個工具來格式化自己的程式碼。

Rust 的安裝預設就包含了 `rustfmt`，所以你的系統上應該已經有 `rustfmt` 和 `cargo-fmt` 這兩個程式了。這兩個指令類似於 `rustc` 和 `cargo`，其中 `rustfmt` 允許更細微的控制，而 `cargo-fmt` 則理解使用 Cargo 的專案慣例。若要格式化任何 Cargo 專案，請輸入以下指令：

```
$ cargo fmt
```

執行這個指令會重新格式化目前 crate 中的所有 Rust 程式碼。這應該只會改變程式碼的風格，而不會改變程式碼的語意。想了解更多關於 `rustfmt` 的資訊，請參閱其文件，網址為 _https://github.com/rust-lang/rustfmt_。

## 使用 rustfix 修正你的程式碼

`rustfix` 工具已包含在 Rust 的安裝中，它可以自動修正編譯器的警告，前提是這些問題有明確的修正方式，且很可能就是你想要的結果。你之前可能已經看過編譯器的警告了。例如，看看這段程式碼：

檔案名稱：src/main.rs

```rust
fn main() {
    let mut x = 42;
    println!("{x}");
}
```

這裡，我們將變數 `x` 定義為可變的，但我們從未真正改變它。Rust 會對此提出警告：

```
$ cargo build
   Compiling myprogram v0.1.0 (file:///projects/myprogram)
warning: variable does not need to be mutable
 --> src/main.rs:2:9
  |
2 |     let mut x = 0;
  |         ----^
  |         |
  |         help: remove this `mut`
  |
  = note: `#[warn(unused_mut)]` on by default
```

這個警告建議我們移除 `mut` 關鍵字。我們可以使用 `rustfix` 工具，透過執行 `cargo fix` 指令來自動套用這個建議：

```
$ cargo fix
    Checking myprogram v0.1.0 (file:///projects/myprogram)
      Fixing src/main.rs (1 fix)
    Finished dev [unoptimized + debuginfo] target(s) in 0.59s
```

當我們再次查看 _src/main.rs_ 時，會發現 `cargo fix` 已經修改了程式碼：

檔案名稱：src/main.rs

```rust
fn main() {
    let x = 42;
    println!("{x}");
}
```

變數 `x` 現在是不可變的了，警告也不再出現。

你也可以使用 `cargo fix` 指令來將你的程式碼在不同的 Rust editions 之間轉換。關於 Editions 的內容，會在[附錄 E](https://doc.rust-lang.org/book/appendix-05-editions.html) 中介紹。

## 使用 Clippy 進行更多 Lints

Clippy 工具是一系列 lints 的集合，用來分析你的程式碼，以便你能夠捕捉常見的錯誤並改善你的 Rust 程式碼。Clippy 已包含在標準的 Rust 安裝中。

要在任何 Cargo 專案上執行 Clippy 的 lints，請輸入以下指令：

```
$ cargo clippy
```

舉例來說，假設你寫了一個程式，使用了一個數學常數（例如 pi）的近似值，就像這個程式一樣：

檔案名稱：src/main.rs

```rust
fn main() {
    let x = 3.1415;
    let r = 8.0;
    println!("the area of the circle is {}", x * r * r);
}
```

在這個專案上執行 `cargo clippy` 會得到以下錯誤：

```
error: approximate value of `f{32, 64}::consts::PI` found
 --> src/main.rs:2:13
  |
2 |     let x = 3.1415;
  |             ^^^^^^
  |
  = note: `#[deny(clippy::approx_constant)]` on by default
  = help: consider using the constant directly
  = help: for further information visit https://rust-lang.github.io/rust-
clippy/master/index.html#approx_constant
```

這個錯誤告訴你 Rust 已經定義了一個更精確的 `PI` 常數，如果使用該常數，你的程式會更正確。然後你就可以修改你的程式碼來使用 `PI` 常數。

以下程式碼不會從 Clippy 收到任何錯誤或警告：

檔案名稱：src/main.rs

```rust
fn main() {
    let x = std::f64::consts::PI;
    let r = 8.0;
    println!("the area of the circle is {}", x * r * r);
}
```

想了解更多關於 Clippy 的資訊，請參閱其文件，網址為 _https://github.com/rust-lang/rust-clippy_。

## 使用 rust-analyzer 進行 IDE 整合

為了幫助進行 IDE 整合，Rust 社群推薦使用 `rust-analyzer`。這個工具是一套以編譯器為中心的工具程式，它遵循 Language Server Protocol，這是一個讓 IDE 和程式語言之間互相溝通的規範。不同的客戶端都可以使用 `rust-analyzer`，例如 Visual Studio Code 的 Rust analyzer 插件，其網址為 _https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer_。

請造訪 `rust-analyzer` 專案的首頁 _https://rust-analyzer.github.io_ 以取得安裝說明，然後在你特定的 IDE 中安裝語言伺服器支援。你的 IDE 將會獲得像是自動完成、跳至定義以及行內錯誤等功能。
